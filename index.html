<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Sena-Re Gear Manager</title>
    <link rel="stylesheet" href="css/style.css?v=1.0.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- 100% Reliable Access Lock -->
    <div id="auth-lock"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0b0c10; z-index:999999; display:flex; align-items:center; justify-content:center; color:white; font-family:sans-serif;">
        <div
            style="background:#1f2833; padding:30px; border-radius:15px; border:2px solid #66fcf1; text-align:center; box-shadow:0 0 20px rgba(102,252,241,0.3); width:320px;">
            <h2 style="color:#66fcf1; margin-bottom:20px;">SENA-RE GEAR</h2>
            <p style="font-size:0.9em; color:#c5c6c7; margin-bottom:20px;">인증 코드를 입력하세요.</p>
            <input type="password" id="final-auth-input" placeholder="코드를 입력하고 엔터" autofocus
                style="width:100%; padding:12px; border-radius:5px; border:1px solid #444; background:#0b0c10; color:white; text-align:center; font-size:1.1em; outline:none; margin-bottom:15px;">
            <button onclick="confirmAuth()"
                style="width:100%; padding:12px; background:#45a29e; border:none; color:black; font-weight:bold; border-radius:5px; cursor:pointer;">접속하기</button>
            <p id="auth-fail-msg" style="color:#ff4444; font-size:0.8em; margin-top:10px; display:none;">잘못된 코드입니다.</p>
        </div>
    </div>

    <script>
        (function () {
            const code = 'senafinal0522';
            const lock = document.getElementById('auth-lock');
            const input = document.getElementById('final-auth-input');
            const fail = document.getElementById('auth-fail-msg');
            const btn = lock.querySelector('button');

            // 실패 횟수 및 잠금 시간 관리
            const getFailCount = () => parseInt(localStorage.getItem('auth_fail_count') || '0');
            const setFailCount = (count) => localStorage.setItem('auth_fail_count', count.toString());
            const getLockUntil = () => parseInt(localStorage.getItem('auth_lock_until') || '0');
            const setLockUntil = (timestamp) => localStorage.setItem('auth_lock_until', timestamp.toString());

            const check = () => {
                if (sessionStorage.getItem('sena_auth') === 'true') {
                    lock.style.display = 'none';
                    return;
                }

                // 잠금 시간 확인
                const lockUntil = getLockUntil();
                const now = Date.now();

                if (lockUntil > now) {
                    const remainSec = Math.ceil((lockUntil - now) / 1000);
                    const remainMin = Math.floor(remainSec / 60);
                    input.disabled = true;
                    btn.disabled = true;
                    fail.style.display = 'block';
                    fail.textContent = `너무 많은 시도로 인해 ${remainMin}분 ${remainSec % 60}초 후 재시도 가능합니다.`;

                    setTimeout(check, 1000); // 1초마다 갱신
                } else {
                    input.disabled = false;
                    btn.disabled = false;
                }
            };

            window.confirmAuth = () => {
                const lockUntil = getLockUntil();
                const now = Date.now();

                if (lockUntil > now) {
                    return; // 잠금 중에는 시도 불가
                }

                if (input.value === code) {
                    sessionStorage.setItem('sena_auth', 'true');
                    localStorage.removeItem('auth_fail_count');
                    localStorage.removeItem('auth_lock_until');
                    lock.style.opacity = '0';
                    setTimeout(() => lock.style.display = 'none', 300);
                } else {
                    const failCount = getFailCount() + 1;
                    setFailCount(failCount);

                    let lockMinutes = 0;
                    if (failCount >= 10) {
                        lockMinutes = 60; // 1시간
                    } else if (failCount >= 5) {
                        lockMinutes = 10; // 10분
                    } else if (failCount >= 3) {
                        lockMinutes = 1; // 1분
                    }

                    if (lockMinutes > 0) {
                        setLockUntil(Date.now() + lockMinutes * 60 * 1000);
                        fail.textContent = `${failCount}회 실패. ${lockMinutes}분 후 재시도 가능합니다.`;
                        input.disabled = true;
                        btn.disabled = true;
                        setTimeout(check, 1000);
                    } else {
                        fail.textContent = `잘못된 코드입니다. (${failCount}/3)`;
                        fail.style.display = 'block';
                    }

                    input.value = '';
                    input.focus();
                }
            };

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmAuth();
            });

            window.resetSena = () => {
                sessionStorage.removeItem('sena_auth');
                localStorage.removeItem('auth_fail_count');
                localStorage.removeItem('auth_lock_until');
                location.reload();
            };

            check();
        })();
    </script>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo"
                style="text-align: center; padding: 25px 15px; border-bottom: 1px solid rgba(212, 87, 109, 0.1);">
                <img src="assets/logo.jpg" alt="Final Guild Logo" style="
                    width: 90px; 
                    height: 90px; 
                    object-fit: contain; 
                    margin: 0 auto 15px; 
                    display: block;
                    border-radius: 12px; 
                    background: linear-gradient(135deg, rgba(26, 19, 21, 0.8), rgba(13, 10, 11, 0.9));
                    padding: 8px;
                    box-shadow: 
                        0 4px 15px rgba(0, 0, 0, 0.4),
                        0 0 20px rgba(212, 87, 109, 0.15),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
                    border: 1px solid rgba(212, 87, 109, 0.2);
                    transition: all 0.3s ease;
                ">
                <h2 style="
                    font-size: 0.85rem; 
                    font-weight: 600; 
                    letter-spacing: 1.2px;
                    color: #d4576d;
                    margin: 0;
                    text-transform: uppercase;
                    text-shadow: 0 0 10px rgba(212, 87, 109, 0.3);
                ">FINAL GUILD<br><span style="font-size: 0.7rem; color: #c5a4a8; font-weight: 400;">MANAGER</span></h2>
            </div>
            <ul class="nav-links">
                <li class="active" data-tab="dashboard">
                    <i class="fas fa-home"></i> <span>대시보드</span>
                </li>
                <li data-tab="heroes">
                    <i class="fas fa-users"></i> <span>영웅 관리</span>
                </li>
                <li data-tab="equipment">
                    <i class="fas fa-suitcase"></i> <span>장비 보관함</span>
                </li>
                <li data-tab="contents">
                    <i class="fas fa-dungeon"></i> <span>세팅 최적화</span>
                </li>
                <li data-tab="presets">
                    <i class="fas fa-save"></i> <span>프리셋 관리</span>
                </li>
                <li data-tab="settings">
                    <i class="fas fa-cog"></i> <span>설정</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-bar">
                <h1 id="page-title">대시보드</h1>
                <div class="user-actions">
                    <button id="help-btn" class="icon-btn" title="도움말"><i class="fas fa-question-circle"></i></button>
                    <div class="profile">
                        <span>대표님</span>
                    </div>
                </div>
            </header>

            <div id="content-area">
                <!-- Dashboard (Default) -->
                <div id="dashboard-section" class="section active">
                    <div class="dashboard-widgets">
                        <div class="widget card">
                            <h3>등록된 영웅</h3>
                            <p class="count" id="hero-count">0</p>
                        </div>
                        <div class="widget card">
                            <h3>보유 장비</h3>
                            <p class="count" id="equip-count">0</p>
                        </div>
                        <div class="widget card">
                            <h3>최근 공략</h3>
                            <p class="recent">없음</p>
                        </div>
                    </div>
                </div>

                <!-- Heroes Management -->
                <div id="heroes-section" class="section" style="display: none;">
                    <div class="section-header">
                        <h2>영웅 관리</h2>
                        <button id="add-hero-btn" class="btn-primary"><i class="fas fa-plus"></i> 영웅 추가</button>
                    </div>
                    <div id="hero-list" class="grid-list">
                        <!-- Hero Cards will be injected here -->
                    </div>
                </div>

                <!-- Equipment Inventory -->
                <div id="equipment-section" class="section" style="display: none;">
                    <div class="section-header">
                        <h2>장비 보관함</h2>
                        <button id="add-equip-btn" class="btn-primary"><i class="fas fa-plus"></i> 장비 추가</button>
                    </div>
                    <div class="advanced-filter-area card">
                        <!-- Category Filter -->
                        <div class="filter-group">
                            <label><i class="fas fa-th-large"></i> 카테고리</label>
                            <div class="filter-chips" id="category-chips">
                                <button class="chip active" data-value="all">전체</button>
                                <button class="chip" data-value="weapon">무기</button>
                                <button class="chip" data-value="armor">방어구</button>
                            </div>
                        </div>

                        <!-- Set Filter -->
                        <div class="filter-group">
                            <label><i class="fas fa-layer-group"></i> 세트 필터</label>
                            <div class="filter-chips" id="set-chips">
                                <button class="chip active" data-value="all">모두</button>
                                <!-- JS에서 동적 생성됨 -->
                            </div>
                        </div>

                        <!-- Main Option Filter -->
                        <div class="filter-group">
                            <label><i class="fas fa-crosshairs"></i> 메인 옵션</label>
                            <div class="filter-chips" id="main-opt-chips">
                                <button class="chip active" data-value="all">모두</button>
                                <!-- JS에서 동적 생성됨 -->
                            </div>
                        </div>

                        <!-- Sub Option Filter & Sort -->
                        <div class="filter-group">
                            <label><i class="fas fa-list-ul"></i> 서브 옵션 제어 (포함/제외/정렬)</label>
                            <div id="sub-opt-filter-list" class="sub-filter-grid">
                                <!-- JS에서 동적 생성됨 (V, X, Sort 버튼 포함) -->
                            </div>
                        </div>
                    </div>
                    <div id="equip-list" class="grid-list">
                        <!-- Equipment Cards will be injected here -->
                    </div>
                </div>

                <!-- Content Strategy Section -->
                <div id="contents-section" class="section" style="display: none;">
                    <div class="section-header">
                        <h2>세팅 최적화</h2>
                    </div>
                    <div class="content-controls card">
                        <div class="form-group">
                            <label>최적화할 영웅 선택</label>
                            <select id="opt-hero-select">
                                <option value="">영웅을 선택하세요</option>
                                <!-- Populated dynamically -->
                            </select>
                        </div>

                        <!-- Priority Settings UI -->
                        <div class="form-group">
                            <label>최적화 우선순위 (영웅 맞춤형)</label>
                            <div id="priority-list-container" class="priority-tag-container">
                                <!-- Selected conditions appear here as tags -->
                            </div>
                            <button id="add-priority-btn" class="btn-primary"
                                style="background: var(--bg-panel); border: 1px dashed var(--primary); color: var(--primary); margin-top: 10px; width: 100%;">
                                <i class="fas fa-plus"></i> 조건 추가
                            </button>
                        </div>
                        <div class="form-group"
                            style="flex-direction: row; align-items: center; justify-content: flex-start; gap: 10px; margin-top: 5px;">
                            <input type="checkbox" id="opt-force-set" checked style="width: auto;">
                            <label for="opt-force-set" style="margin: 0; cursor: pointer;">세트 효과 우선 (체크 해제 시 깡스탯
                                위주)</label>
                        </div>
                        <button id="optimize-btn" class="btn-primary" style="width:100%; margin-top:10px;">최적 장비
                            찾기</button>

                        <div id="opt-results-area" style="margin-top: 20px;">
                            <!-- Results injected here -->
                        </div>
                    </div>
                </div>

                <!-- Preset Management Section -->
                <div id="presets-section" class="section" style="display: none;">
                    <div class="section-header">
                        <h2>프리셋 관리</h2>
                    </div>
                    <div id="preset-list" class="grid-list">
                        <!-- Preset Cards will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Modals -->
            <div id="hero-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2 id="hero-modal-title">영웅 등록</h2>
                    <form id="hero-form">
                        <input type="hidden" id="hero-id">
                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" id="hero-name" required placeholder="예: 파스칼">
                        </div>
                        <div class="form-group">
                            <label>타입</label>
                            <select id="hero-type">
                                <option value="magic">마법형</option>
                                <option value="physical">물리형</option>
                            </select>
                        </div>
                        <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group"><label>공격력</label><input type="number" id="hero-atk"
                                    placeholder="0"></div>
                            <div class="form-group"><label>방어력</label><input type="number" id="hero-def"
                                    placeholder="0"></div>
                            <div class="form-group"><label>생명력</label><input type="number" id="hero-hp" placeholder="0">
                            </div>
                            <div class="form-group"><label>속공</label><input type="number" id="hero-spd" placeholder="0">
                            </div>
                            <div class="form-group"><label>치명타 확률 (%)</label><input type="number" id="hero-crit-rate"
                                    placeholder="0"></div>
                            <div class="form-group"><label>치명타 피해 (%)</label><input type="number" id="hero-crit-dmg"
                                    placeholder="0"></div>
                            <div class="form-group"><label>약점 공격 (%)</label><input type="number" id="hero-weak-rate"
                                    placeholder="0"></div>
                            <div class="form-group"><label>막기 확률 (%)</label><input type="number" id="hero-block-rate"
                                    placeholder="0"></div>
                            <div class="form-group"><label>효과 적중 (%)</label><input type="number" id="hero-eff-hit"
                                    placeholder="0"></div>
                            <div class="form-group"><label>효과 저항 (%)</label><input type="number" id="hero-eff-res"
                                    placeholder="0"></div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button type="submit" class="btn-submit" style="flex:2;">저장</button>
                            <button type="button" id="btn-delete-hero" class="btn-danger"
                                style="flex:1; display:none; background-color:#ff4444; color:white; border:none; border-radius:4px; cursor:pointer;">
                                삭제
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="equip-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>장비 등록</h2>
                    <form id="equip-form">
                        <input type="hidden" id="equip-id">
                        <div class="form-group">
                            <label>구분</label>
                            <select id="equip-category">
                                <option value="weapon_physical">물리 무기</option>
                                <option value="weapon_magic">마법 무기</option>
                                <option value="armor">방어구</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>세트</label>
                            <select id="equip-set">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>장비명</label>
                            <input type="text" id="equip-name" required placeholder="예: 빛나는 드래곤 슬레이어">
                        </div>
                        <div class="form-group">
                            <label>메인 옵션</label>
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <select id="equip-main-opt">
                                    <!-- Populated dynamically -->
                                </select>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="number" id="equip-main-val" placeholder="수치" style="flex: 1;">
                                    <span id="standard-stat-guide"
                                        style="font-size: 0.85em; color: var(--primary); font-weight: 700; white-space: nowrap;"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>서브 옵션 (최대 4개)</label>
                            <div class="sub-opt-row" style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <select class="equip-sub-opt" style="flex: 2;"></select>
                                <input type="number" class="equip-sub-val" placeholder="수치" style="flex: 1;">
                            </div>
                            <div class="sub-opt-row" style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <select class="equip-sub-opt" style="flex: 2;"></select>
                                <input type="number" class="equip-sub-val" placeholder="수치" style="flex: 1;">
                            </div>
                            <div class="sub-opt-row" style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <select class="equip-sub-opt" style="flex: 2;"></select>
                                <input type="number" class="equip-sub-val" placeholder="수치" style="flex: 1;">
                            </div>
                            <div class="sub-opt-row" style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <select class="equip-sub-opt" style="flex: 2;"></select>
                                <input type="number" class="equip-sub-val" placeholder="수치" style="flex: 1;">
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:20px;">
                            <button type="submit" class="btn-submit" style="flex:2;">등록</button>
                            <button type="button" id="btn-delete-equip" class="btn-danger"
                                style="flex:1; display:none; background-color:#ff4444; color:white; border:none; border-radius:4px;">삭제</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Moved logic to contents section directly -->

            <!-- Equipment Detail Modal -->
            <div id="equip-detail-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2 id="detail-name" style="color:var(--accent-color);">장비 이름</h2>
                    <div class="detail-info" style="margin-top:20px; text-align:left;">
                        <p><strong style="color:#aaa;">종류:</strong> <span id="detail-type"></span></p>
                        <p><strong style="color:#aaa;">세트:</strong> <span id="detail-set"></span></p>
                        <hr style="border-color:#444; margin:15px 0;">
                        <h3 style="font-size:1.1rem; margin-bottom:10px;">메인 옵션</h3>
                        <p id="detail-main" style="color:#ffd700; font-size:1.2rem;"></p>
                        <hr style="border-color:#444; margin:15px 0;">
                        <h3 style="font-size:1.1rem; margin-bottom:10px;">서브 옵션</h3>
                        <div id="detail-subs"></div>
                    </div>
                </div>
            </div>

            <!-- Priority Add Modal -->
            <div id="priority-modal" class="modal">
                <div class="modal-content" style="width: 350px;">
                    <span class="close-modal">&times;</span>
                    <h2>조건 추가</h2>
                    <div class="form-group">
                        <label>스탯 선택</label>
                        <select id="p-stat-select">
                            <option value="physical_attack">물리 공격력</option>
                            <option value="magic_attack">마법 공격력</option>
                            <option value="defense">방어력</option>
                            <option value="hp">생명력</option>
                            <option value="speed">속공</option>
                            <option value="crit_rate">치명타 확률</option>
                            <option value="crit_damage">치명타 피해</option>
                            <option value="weakness_rate">약점 공격</option>
                            <option value="block_rate">막기 확률</option>
                            <option value="effect_hit">효과 적중</option>
                            <option value="effect_resist">효과 저항</option>
                            <option value="counter_rate">반격 확률</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>목표 방식</label>
                        <select id="p-type-select">
                            <option value="max">최대화 (Max)</option>
                            <option value="min">목표값 이상 (Min)</option>
                        </select>
                    </div>
                    <div id="p-val-group" class="form-group" style="display: none;">
                        <label>목표 수치</label>
                        <input type="number" id="p-val-input" placeholder="값을 입력하세요">
                    </div>
                    <button id="p-confirm-btn" class="btn-primary" style="width: 100%; margin-top: 10px;">추가하기</button>
                </div>
            </div>

            <!-- Help Modal -->
            <div id="help-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2><i class="fas fa-question-circle"></i> 도움말</h2>
                    <div class="help-text" style="line-height: 1.6; color: #ddd;">
                        <h3>1. 영웅 등록</h3>
                        <p>좌측 '영웅 관리' 메뉴에서 [+ 영웅 추가] 버튼을 눌러보세요. 파스칼, 세인 등 보유한 영웅의 스탯을 입력하면 됩니다.</p>
                        <br>
                        <h3>2. 장비 등록</h3>
                        <p>'장비 보관함'에서 무기와 방어구를 등록하세요. 세트 옵션과 메인/서브 옵션을 정확히 입력할수록 추천이 정확해집니다.</p>
                        <br>
                        <h3>3. 최적 세팅 추천</h3>
                        <p>'콘텐츠 공략' 메뉴에서 [레이드]나 [쫄작]을 선택하세요. 코다리가 분석한 최적의 장비 조합을 자동으로 찾아줍니다!</p>
                        <br>
                        <h3>4. 영웅별 맞춤 설정</h3>
                        <p>영웅 카드의 <i class="fas fa-cog"></i> 버튼을 눌러보세요. "나는 이 영웅에게 치명타를 몰아주고 싶어!"라고 설정할 수 있습니다.</p>
                    </div>
                </div>
            </div>
    </div>
    </main>
    </div>

    <script type="module" src="js/app.js?v=1.0.2"></script>
</body>

</html>